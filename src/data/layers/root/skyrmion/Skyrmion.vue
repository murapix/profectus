<template>
    <div class="skyrmion-container">
        <ul class="skyrmion-grid">
            <li class="skyrmion-upgrade reset">
                <slot />
            </li>
            <template v-for="(upgrade, index) in unref(upgrades)" :key="index">
                <li
                    class="skyrmion-upgrade"
                    :style="getPos(index)"
                    v-if="isVisible(upgrade.visibility)"
                >
                    <component :is="render(upgrade)" />
                </li>
            </template>
        </ul>
    </div>
</template>

<script setup lang="ts">
import { StyleValue, isVisible } from "features/feature";
import { render } from "util/vue";
import { unref } from "vue";
import skyrmion from "./skyrmion";

const upgrades = skyrmion.upgrades;
const positions: Record<keyof typeof upgrades, { row: number; col: number }> = {
    fome: { row: 2, col: 7 },
    autoGain: { row: 2, col: 11 },
    alpha: { row: 3, col: 5 },
    beta: { row: 3, col: 9 },
    gamma: { row: 3, col: 13 },
    delta: { row: 4, col: 3 },
    epsilon: { row: 4, col: 7 },
    zeta: { row: 4, col: 11 },
    eta: { row: 4, col: 15 },
    theta: { row: 5, col: 1 },
    iota: { row: 5, col: 5 },
    kappa: { row: 5, col: 9 },
    lambda: { row: 5, col: 13 },
    mu: { row: 5, col: 17 },
    nu: { row: 6, col: 3 },
    xi: { row: 6, col: 7 },
    pi: { row: 6, col: 11 },
    rho: { row: 6, col: 15 }
};
function getPos(index: keyof typeof upgrades) {
    return { "--row": positions[index].row, "--col": positions[index].col } as StyleValue;
}
</script>

<style scoped>
.skyrmion-container {
    --upgrade-width: 120px;
    --width: 5;
    --row: 1;
    --col: 1;
    --gap: 10px;
    width: calc(
        var(--width) * var(--upgrade-width) + (var(--width) - 1) * var(--upgrade-width) / 2 +
            (var(--width) - 1) * var(--gap)
    );
}

.skyrmion-grid {
    display: grid;
    grid-template-columns: repeat(calc(var(--width) * 2 - 1), 1fr 2fr) 1fr;
    grid-gap: var(--gap) calc(var(--gap) * 2);
    list-style-type: none;
    margin-left: calc(0px - (var(--gap) / 2));
    padding: 0;
}

.skyrmion-upgrade {
    position: relative;
    grid-column: var(--col) / span 3;
    grid-row: var(--row) / span 2;
    height: 0;
    padding-bottom: var(--upgrade-width);
    margin: 0;
}

.skyrmion-upgrade.skyrmion-upgrade > * > button:hover {
    box-shadow: none;
}

.skyrmion-upgrade.reset {
    --row: 1;
    --col: 9;
}

.skyrmion-upgrade :deep(button) {
    position: absolute;
    top: 0;
    left: 0;
    margin: 0;
    border: 0;
    border-radius: 0;
    clip-path: polygon(75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%, 25% 0%);
    width: var(--upgrade-width);
    min-height: var(--upgrade-width);
}
</style>
